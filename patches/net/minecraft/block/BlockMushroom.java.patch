--- ../src-base/minecraft/net/minecraft/block/BlockMushroom.java
+++ ../src-work/minecraft/net/minecraft/block/BlockMushroom.java
@@ -1,11 +1,27 @@
 package net.minecraft.block;
 
 import java.util.Random;
+
+import net.minecraft.entity.player.EntityPlayerMP;
 import net.minecraft.init.Blocks;
+import net.minecraft.server.MinecraftServer;
 import net.minecraft.world.World;
 import net.minecraft.world.gen.feature.WorldGenBigMushroom;
 import net.minecraftforge.common.util.ForgeDirection;
 
+// CraftBukkit start
+import java.util.ArrayList;
+
+import net.minecraft.item.ItemDye;
+import net.minecraft.item.ItemStack;
+import org.bukkit.Location;
+import org.bukkit.TreeType;
+import org.bukkit.block.BlockState;
+import org.bukkit.entity.Player;
+import org.bukkit.event.block.BlockSpreadEvent;
+import org.bukkit.event.world.StructureGrowEvent;
+// CraftBukkit end
+
 public class BlockMushroom extends BlockBush implements IGrowable
 {
     private static final String __OBFID = "CL_00000272";
@@ -19,7 +35,9 @@
 
     public void func_149674_a(World p_149674_1_, int p_149674_2_, int p_149674_3_, int p_149674_4_, Random p_149674_5_)
     {
-        if (p_149674_5_.nextInt(25) == 0)
+        final int sourceX = p_149674_2_, sourceY = p_149674_3_, sourceZ = p_149674_4_; // CraftBukkit
+
+        if (p_149674_5_.nextInt(Math.max(1, (int) p_149674_1_.growthOdds / p_149674_1_.spigotConfig.mushroomModifier * 25)) == 0)   // Spigot
         {
             byte b0 = 4;
             int l = 5;
@@ -66,7 +84,19 @@
 
             if (p_149674_1_.func_147437_c(i1, j1, k1) && this.func_149718_j(p_149674_1_, i1, j1, k1))
             {
-                p_149674_1_.func_147465_d(i1, j1, k1, this, 0, 2);
+                // CraftBukkit start
+                org.bukkit.World bworld = p_149674_1_.getWorld();
+                BlockState blockState = bworld.getBlockAt(i1, j1, k1).getState();
+                blockState.setTypeId(Block.func_149682_b(this)); // nms: this.id, 0, 2
+                BlockSpreadEvent event = new BlockSpreadEvent(blockState.getBlock(), bworld.getBlockAt(sourceX, sourceY, sourceZ), blockState);
+                p_149674_1_.getServer().getPluginManager().callEvent(event);
+
+                if (!event.isCancelled())
+                {
+                    blockState.update(true);
+                }
+
+                // CraftBukkit end
             }
         }
     }
@@ -92,32 +122,89 @@
         {
             return false;
         }
-    }
+    } 
 
+    /**
+     * Fertilize the mushroom.
+     */
     public boolean func_149884_c(World p_149884_1_, int p_149884_2_, int p_149884_3_, int p_149884_4_, Random p_149884_5_)
     {
         int l = p_149884_1_.getBlockMetadata(p_149884_2_, p_149884_3_, p_149884_4_);
         p_149884_1_.func_147468_f(p_149884_2_, p_149884_3_, p_149884_4_);
+        // CraftBukkit start
+        boolean grown = false;
+        StructureGrowEvent event = null;
+        Location location = new Location(p_149884_1_.getWorld(), p_149884_2_, p_149884_3_, p_149884_4_);
         WorldGenBigMushroom worldgenbigmushroom = null;
+        TreeType treeType = null;
 
+        // MCPC+ start - Refactor cb patch
+        EntityPlayerMP entityplayer = MinecraftServer.getServer().getConfigurationManager().getPlayerForUsername(ItemStack.currentPlayerName);
+        Player player = entityplayer != null ? entityplayer.getBukkitEntity() : null;
+        ItemStack itemstack = null;
+        boolean bonemeal = false;
+        if (entityplayer != null && entityplayer.getItemInUse().getItem() != null)
+        {
+            bonemeal = (entityplayer.getItemInUse().getItem() instanceof ItemDye && entityplayer.getItemInUse().getItemDamage() == 15);
+            itemstack = entityplayer.getItemInUse();
+        }
+
         if (this == Blocks.brown_mushroom)
         {
+            treeType = TreeType.BROWN_MUSHROOM;
             worldgenbigmushroom = new WorldGenBigMushroom(0);
         }
         else if (this == Blocks.red_mushroom)
         {
+            treeType = TreeType.RED_MUSHROOM;
             worldgenbigmushroom = new WorldGenBigMushroom(1);
         }
 
-        if (worldgenbigmushroom != null && worldgenbigmushroom.generate(p_149884_1_, p_149884_5_, p_149884_2_, p_149884_3_, p_149884_4_))
+        if (worldgenbigmushroom != null)
         {
-            return true;
-        }
-        else
+            p_149884_1_.runningTreeGeneration = true;
+            p_149884_1_.captureBlockStates = true;
+            grown = worldgenbigmushroom.generate(p_149884_1_, p_149884_5_, p_149884_2_, p_149884_3_, p_149884_4_);
+            p_149884_1_.captureBlockStates = false;
+            p_149884_1_.runningTreeGeneration = false;
+            if (grown)
+            {
+                if (player != null)
+                {
+                    event = new StructureGrowEvent(location, treeType, bonemeal, player, p_149884_1_.capturedBlockStates);
+                    org.bukkit.Bukkit.getPluginManager().callEvent(event);
+                }
+
+                if (event != null && event.isCancelled())
+                {
+                    grown = false;
+                }
+                else
+                {
+                    for (BlockState blockstate : p_149884_1_.capturedBlockStates)
+                    {
+                        blockstate.update(true);
+                    }
+
+                    if (itemstack != null && itemstack.getItem() instanceof ItemDye && itemstack.getItemDamage() == 15)
+                    {
+                        --itemstack.stackSize;
+                    }
+                }
+            }
+        } 
+
+        if (!grown || event.isCancelled())
         {
+            p_149884_1_.capturedBlockStates.clear();
             p_149884_1_.func_147465_d(p_149884_2_, p_149884_3_, p_149884_4_, this, l, 3);
             return false;
         }
+        p_149884_1_.capturedBlockStates.clear();
+        // MCPC+ end
+
+        return true;
+        // CraftBukkit end
     }
 
     public boolean func_149851_a(World p_149851_1_, int p_149851_2_, int p_149851_3_, int p_149851_4_, boolean p_149851_5_)
