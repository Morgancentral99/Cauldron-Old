--- ../src-base/minecraft/net/minecraft/entity/monster/EntityCreeper.java
+++ ../src-work/minecraft/net/minecraft/entity/monster/EntityCreeper.java
@@ -23,6 +23,11 @@
 import net.minecraft.util.DamageSource;
 import net.minecraft.world.World;
 
+// CraftBukkit start
+import org.bukkit.craftbukkit.event.CraftEventFactory;
+import org.bukkit.event.entity.ExplosionPrimeEvent;
+// CraftBukkit end
+
 public class EntityCreeper extends EntityMob
 {
     // JAVADOC FIELD $$ field_70834_e
@@ -32,6 +37,7 @@
     private int fuseTime = 30;
     // JAVADOC FIELD $$ field_82226_g
     private int explosionRadius = 3;
+    private int record = -1; // CraftBukkit
     private static final String __OBFID = "CL_00001684";
 
     public EntityCreeper(World par1World)
@@ -174,17 +180,57 @@
     // JAVADOC METHOD $$ func_70645_a
     public void onDeath(DamageSource par1DamageSource)
     {
-        super.onDeath(par1DamageSource);
-
+        // CraftBukkit start - Rearranged the method (super call to end, drop to dropDeathLoot)
         if (par1DamageSource.getEntity() instanceof EntitySkeleton)
         {
             int i = Item.func_150891_b(Items.record_13);
             int j = Item.func_150891_b(Items.record_wait);
             int k = i + this.rand.nextInt(j - i + 1);
-            this.func_145779_a(Item.func_150899_d(k), 1);
+            // this.func_145779_a(Item.func_150899_d(k), 1); // CraftBukkit
+            this.record = k;
         }
+
+        super.onDeath(par1DamageSource);
+        // CraftBukkit end
     }
 
+    // CraftBukkit start - Whole method
+
+    /**
+     * Drop 0-2 items of this living's type. @param par1 - Whether this entity has recently been hit by a player. @param
+     * par2 - Level of Looting used to kill this mob.
+     */
+    protected void dropFewItems(boolean flag, int i)
+    {
+        Item j = this.func_146068_u();
+        java.util.List<org.bukkit.inventory.ItemStack> loot = new java.util.ArrayList<org.bukkit.inventory.ItemStack>();
+
+        if (j != null)
+        {
+            int k = this.rand.nextInt(3);
+
+            if (i > 0)
+            {
+                k += this.rand.nextInt(i + 1);
+            }
+
+            if (k > 0)
+            {
+                loot.add(new org.bukkit.inventory.ItemStack(org.bukkit.craftbukkit.util.CraftMagicNumbers.getMaterial(j), k));
+            }
+        }
+
+        // Drop a music disc?
+        if (this.record != -1)
+        {
+            loot.add(new org.bukkit.inventory.ItemStack(this.record, 1)); // TODO: Material
+            this.record = -1;
+        }
+
+        CraftEventFactory.callEntityDeathEvent(this, loot); // raise event even for those times when the entity does not drop loot
+    }
+    // CraftBukkit end
+
     public boolean attackEntityAsMob(Entity par1Entity)
     {
         return true;
@@ -224,9 +270,30 @@
     public void onStruckByLightning(EntityLightningBolt par1EntityLightningBolt)
     {
         super.onStruckByLightning(par1EntityLightningBolt);
-        this.dataWatcher.updateObject(17, Byte.valueOf((byte)1));
+
+        // CraftBukkit start
+        if (CraftEventFactory.callCreeperPowerEvent(this, par1EntityLightningBolt, org.bukkit.event.entity.CreeperPowerEvent.PowerCause.LIGHTNING).isCancelled())
+        {
+            return;
+        }
+
+        this.setPowered(true);
     }
 
+    public void setPowered(boolean powered)
+    {
+        if (!powered)
+        {
+            this.dataWatcher.updateObject(17, Byte.valueOf((byte) 0));
+        }
+        else
+        {
+            this.dataWatcher.updateObject(17, Byte.valueOf((byte) 1));
+        }
+
+        // CraftBukkit end
+    }
+
     // JAVADOC METHOD $$ func_70085_c
     protected boolean interact(EntityPlayer par1EntityPlayer)
     {
@@ -253,17 +320,22 @@
         if (!this.worldObj.isRemote)
         {
             boolean flag = this.worldObj.getGameRules().getGameRuleBooleanValue("mobGriefing");
+            // CraftBukkit start
+            float radius = this.getPowered() ? 6.0F : 3.0F;
+            ExplosionPrimeEvent event = new ExplosionPrimeEvent(this.getBukkitEntity(), radius, false);
+            this.worldObj.getServer().getPluginManager().callEvent(event);
 
-            if (this.getPowered())
+            if (!event.isCancelled())
             {
-                this.worldObj.createExplosion(this, this.posX, this.posY, this.posZ, (float)(this.explosionRadius * 2), flag);
+                this.worldObj.newExplosion(this, this.posX, this.posY, this.posZ, event.getRadius(), event.getFire(), flag);
+                this.setDead();
             }
             else
             {
-                this.worldObj.createExplosion(this, this.posX, this.posY, this.posZ, (float)this.explosionRadius, flag);
+                this.timeSinceIgnited = 0;
             }
 
-            this.setDead();
+            // CraftBukkit end
         }
     }
 
